<%#
  Formulario para crear o editar un Tipo de Ausencia.
  Contiene todos los campos definidos en la guía de estructura.
%>
<%= form_with(model: [:admin, tipo_ausencia], local: true, html: { class: "needs-validation", novalidate: true }) do |form| %>
  <% if tipo_ausencia.errors.any? %>
    <div class="alert alert-danger" role="alert">
      <h4 class="alert-heading">Se encontraron <%= pluralize(tipo_ausencia.errors.count, "error") %></h4>
      <p>Por favor, corrige los siguientes problemas:</p>
      <hr>
      <ul>
        <% tipo_ausencia.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="card">
    <div class="card-body">
      <%# 1. Nombre %>
      <div class="mb-4">
        <%= form.label :nombre, class: "form-label fw-bold" %>
        <%= form.text_field :nombre, class: "form-control", required: true %>
        <div class="form-text">Nombre único y descriptivo que aparecerá en los desplegables.</div>
      </div>

      <%# Abreviatura %>
      <div class="mb-4">
        <%= form.label :abreviatura, class: "form-label fw-bold" %>
        <%= form.text_field :abreviatura, class: "form-control", required: true, maxlength: 10 %>
        <div class="form-text">Abreviatura de máx. 10 caracteres que se mostrará en el selector principal (ej. "VAC").</div>
      </div>

      <%# 2. Modalidad %>
      <div class="mb-4">
        <p class="form-label fw-bold">Modalidad</p>
        <div class="form-check">
          <%= form.radio_button :es_fraccionable, false, class: 'form-check-input', id: 'modalidad_dia_completo' %>
          <%= form.label :es_fraccionable_false, "Día Completo", class: 'form-check-label', for: 'modalidad_dia_completo' %>
          <div class="form-text">La ausencia cubre todas las horas teóricas del día. Ideal para vacaciones, bajas, etc.</div>
        </div>
        <div class="form-check mt-2">
          <%= form.radio_button :es_fraccionable, true, class: 'form-check-input', id: 'modalidad_por_horas' %>
          <%= form.label :es_fraccionable_true, "Por Horas", class: 'form-check-label', for: 'modalidad_por_horas' %>
          <div class="form-text">Requiere introducir manualmente el número de horas. Útil para permisos cortos, visitas médicas, etc.</div>
        </div>
      </div>

      <%# 3. ¿Es Retribuida? %>
      <div class="mb-4 form-check form-switch">
        <%= form.check_box :es_retribuida, class: 'form-check-input', role: 'switch' %>
        <%= form.label :es_retribuida, '¿Es Retribuida?', class: 'form-check-label fw-bold' %>
        <div class="form-text mt-1">Si está marcado, las horas de ausencia cuentan como trabajadas para la jornada anual.</div>
      </div>

      <%# Límite Anual de Horas %>
      <div class="mb-4">
        <%= form.label :limite_horas_anuales, "Límite Anual de Horas (opcional)", class: "form-label fw-bold" %>
        <%= form.number_field :limite_horas_anuales, class: "form-control", step: 0.25, min: 0, placeholder: "Sin límite" %>
        <div class="form-text">Si se establece un límite, las horas que lo superen dentro de un año natural generarán deuda en la bolsa ordinaria, incluso si la ausencia es retribuida.</div>
      </div>

      <%# 4. Bolsa de Horas Afectada %>
      <div class="mb-4">
        <%
          opciones_bolsa = TipoAusencia.categoria_bolsa_afectadas.keys.map do |key|
            texto = key.to_s.gsub('_', ' ').capitalize
            [texto, key]
          end
        %>
        <%= form.label :categoria_bolsa_afectada, "Bolsa de Horas Afectada", class: "form-label fw-bold" %>
        <%= form.select :categoria_bolsa_afectada, opciones_bolsa, {}, class: "form-select" %>
        <div class="form-text">Especifica de qué bolsa se deben restar las horas al registrar esta ausencia.</div>
      </div>

      <%# 5. ¿Genera un déficit en la bolsa? %>
      <div class="mb-4 form-check form-switch">
        <%= form.check_box :genera_deuda_en_bolsa, class: 'form-check-input', role: 'switch' %>
        <%= form.label :genera_deuda_en_bolsa, '¿Genera un déficit en la bolsa?', class: 'form-check-label fw-bold' %>
        <div class="form-text mt-1">Si está marcado, la ausencia genera un déficit en la bolsa ordinaria que el trabajador deberá recuperar (ej. Ausencia Injustificada).</div>
      </div>
    </div>
  </div>

  <div class="mt-4">
    <%= form.submit "Guardar Tipo de Ausencia", class: 'btn btn-primary' %>
    <%= link_to 'Cancelar', admin_tipo_ausencias_path, class: 'btn btn-secondary' %>
  </div>
<% end %>